<div class="request-approval-route-container">
  <!-- Toast Messages with enhanced configuration -->
  <p-toast position="top-right" [baseZIndex]="10001" [preventOpenDuplicates]="true" [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>
  
  <!-- Confirmation Dialog -->
  <p-confirmDialog [style]="{width: '500px'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text"></p-confirmDialog>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Table Header Actions -->
  <div *ngIf="!loading" class="table-header-actions">
    <div class="left-actions">
      <h3>Request Approval Routes</h3>
    </div>

    <div class="right-actions">
        <div class="input-group search-container">

      <!-- Dropdown Button -->
      <div class="input-group-prepend" [ngClass]="{
      'order-0': langService.getCurrentLang() === 'en', 
      'order-1': langService.getCurrentLang() === 'ar'}">

        <button class="btn  dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="    background-color: white;
            border-bottom-right-radius: unset;
            border-top-right-radius: unset;
            border: 1px solid #e8e3e3;">
          <i class="fas fa-search"></i>
        </button>
        <ul class="dropdown-menu">
          <li *ngFor="let col of searchColumns">
            <a class="dropdown-item" (click)="selectColumn(col)">
              {{ col.label | translate }}
            </a>
          </li>
        </ul>
      </div>

      <!-- Search Input -->
      <input type="text" class="form-control" [placeholder]="'Search: '+(selectedColumnLabel | translate)"
        [(ngModel)]="searchTerm" [title]="'MENU.GENERAL_DATA.EMPLOYEES_ACTIONS.SEARCH_TITLE' | translate" [ngClass]="{
            'order-1': langService.getCurrentLang() === 'en',
            'order-0': langService.getCurrentLang() === 'ar'
          }">
    </div>
    <button class="btn " type="button" (click)="onSearch()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;">
      {{ 'SEARCH' | translate }}
    </button>
    </div>
  </div>

  <!-- Custom Table -->
  <div *ngIf="!loading" class="table-wrapper" title="Scroll horizontally to see more columns">
    <table class="custom-table">
      <thead>
        <tr class="table-header">
          <th class="action-column">Edit</th>
          <th>ID</th>
          <th>Employee</th>
          <th>Manager of Department</th>
          <th>Department</th>
          <th>Manager of Branch</th>
          <th>Branch</th>
          <th>Role</th>
          <th>For Everyone</th>
          <th>Status</th>
          <th>Request Levels</th>
          <th>Is Active</th>
          <th>Note</th>
          <th class="action-column">Details</th>
          <th class="action-column">Chart</th>
          <th class="action-column">Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let route of approvalRoutes; trackBy: trackByRouteId" class="table-row">
          <!-- Edit Action -->
          <td class="action-column">
            <button class="action-btn details-btn" 
                    (click)="editRoute(route)"
                    title="Edit">
              <i class="fa fa-edit"></i>
            </button>
          </td>
          
          <!-- ID -->
          <td class="text-center">{{ route.routeId }}</td>
          
          <!-- Employee -->
          <td>{{ route.empName || '-' }}</td>
          
          <!-- Manager of Department -->
          <td>{{ route.deptMgrName || '-' }}</td>
          
          <!-- Department -->
          <td>{{ route.deptName || '-' }}</td>
          
          <!-- Manager of Branch -->
          <td>{{ route.branchMgrName || '-' }}</td>
          
          <!-- Branch -->
          <td>{{ route.branchName || '-' }}</td>
          
          <!-- Role -->
          <td>{{ route.roleName || '-' }}</td>
          
          <!-- For Everyone -->
          <td>{{ route.forEveryoneName || '-' }}</td>
          
          <!-- Status -->
          <td>{{ route.stsName || '-' }}</td>
          
          <!-- Request Levels -->
          <td>{{ route.reqLevelName || '-' }}</td>
          
          <!-- Is Active -->
          <td class="text-center">
            <span [class]="getActiveStatusClass(route.isActive)">
              <i [class]="route.isActive ? 'fa fa-check-circle' : 'fa fa-times-circle'"></i>
              {{ route.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          
          <!-- Note -->
          <td>{{ route.note || '-' }}</td>
          
          <!-- Details Action -->
          <td class="action-column">
            <button class="action-btn graph-btn" 
                    (click)="viewDetails(route)"
                    title="Details">
              <i class="fa fa-list-alt"></i>
            </button>
          </td>
          
          <!-- Chart Action -->
          <td class="action-column">
            <button class="action-btn attachments-btn" 
                    (click)="viewChart(route)"
                    title="Chart">
              <i class="fa fa-chart-line"></i>
            </button>
          </td>
          
          <!-- Delete Action -->
          <td class="action-column">
            <button class="action-btn delete-btn" 
                    (click)="deleteRoute(route)"
                    title="Delete">
              <i class="fa fa-trash"></i>
            </button>
          </td>
        </tr>
        
        <!-- Empty state row -->
        <tr *ngIf="approvalRoutes.length === 0" class="empty-row">
          <td colspan="16" class="empty-message text-center">
            <i class="fa fa-inbox"></i>
            No approval routes found
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Custom Pagination -->
  <div *ngIf="!loading && approvalRoutes.length > 0" class="pagination-wrapper" 
       [class.rtl]="langService.getCurrentLang() === 'ar'" 
       [class.ltr]="langService.getCurrentLang() === 'en'">
    <div class="pagination-info">
      <span>Showing {{ currentPageStart }} to {{ currentPageEnd }} of {{ totalRecords }} items</span>
    </div>

    <div class="pagination-controls">
      <!-- Arabic RTL Layout -->
      <ng-container *ngIf="(langService.getCurrentLang() === 'ar')">
        <!-- Last Button -->
        <button class="pagination-btn first-last-btn" 
                [disabled]="!canGoNext" 
                (click)="goToLastPage()"
                title="Last">
          <i class="fa fa-angle-double-left"></i>
        </button>
        
        <!-- Next Button -->
        <button class="pagination-btn" 
                [disabled]="!canGoNext" 
                (click)="nextPage()"
                title="Next">
          <i class="fa fa-angle-left"></i>
        </button>
        
        <!-- Page Info -->
        <div class="page-info-enhanced">
          <span class="page-number">{{ currentPage }}</span>
          <span class="page-separator">/</span>
          <span class="total-pages">{{ totalPages }}</span>
        </div>
        
        <!-- Previous Button -->
        <button class="pagination-btn" 
                [disabled]="!canGoPrevious" 
                (click)="previousPage()"
                title="Previous">
          <i class="fa fa-angle-right"></i>
        </button>
        
        <!-- First Button -->
        <button class="pagination-btn first-last-btn" 
                [disabled]="!canGoPrevious" 
                (click)="goToFirstPage()"
                title="First">
          <i class="fa fa-angle-double-right"></i>
        </button>
      </ng-container>
      
      <!-- English LTR Layout -->
      <ng-container *ngIf="(langService.getCurrentLang() === 'en')">
        <!-- First Button -->
        <button class="pagination-btn first-last-btn" 
                [disabled]="!canGoPrevious" 
                (click)="goToFirstPage()"
                title="First">
          <i class="fa fa-angle-double-left"></i>
        </button>
        
        <!-- Previous Button -->
        <button class="pagination-btn" 
                [disabled]="!canGoPrevious" 
                (click)="previousPage()"
                title="Previous">
          <i class="fa fa-angle-left"></i>
        </button>
        
        <!-- Page Info -->
        <div class="page-info-enhanced">
          <span class="page-number">{{ currentPage }}</span>
          <span class="page-separator">/</span>
          <span class="total-pages">{{ totalPages }}</span>
        </div>
        
        <!-- Next Button -->
        <button class="pagination-btn" 
                [disabled]="!canGoNext" 
                (click)="nextPage()"
                title="Next">
          <i class="fa fa-angle-right"></i>
        </button>
        
        <!-- Last Button -->
        <button class="pagination-btn first-last-btn" 
                [disabled]="!canGoNext" 
                (click)="goToLastPage()"
                title="Last">
          <i class="fa fa-angle-double-right"></i>
        </button>
      </ng-container>
    </div>

    <div class="page-size-selector">
      <label>Items per page</label>
        <select [(ngModel)]="paginationRequest.pageSize" (change)="onPageSizeChange()">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
    </div>
  </div>
  
  <!-- Road Map Modal -->
  <div class="modal-backdrop" *ngIf="showRoadMapModal" (click)="onCloseRoadMapModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h4>Request Approval Road Map</h4>
        <button class="close-btn" (click)="onCloseRoadMapModal()">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Search for Road Map -->
        <div class="search-container modal-search" 
             [class.rtl]="langService.getCurrentLang() === 'ar'" 
             [class.ltr]="langService.getCurrentLang() === 'en'">
          <form [formGroup]="roadMapSearchForm">
            <input 
              type="text" 
              formControlName="searchText"
              class="search-input" 
              placeholder="Search road map details...">
          </form>
        </div>
        
        <!-- Road Map Table -->
        <div *ngIf="loadingRoadMap" class="loading-spinner">
          <div class="spinner"></div>
          <p>Loading...</p>
        </div>
        
        <div *ngIf="!loadingRoadMap" class="table-wrapper modal-table">
          <table class="custom-table">
            <thead>
              <tr class="table-header">
                <th>Level</th>
                <th>Level Name</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detail of filteredRoadMapDetails; trackBy: trackByRoadMapLevel" class="table-row">
                <td class="text-center">{{ detail.level }}</td>
                <td>{{ detail.levelName || '-' }}</td>
                <td>{{ detail.details || '-' }}</td>
              </tr>
              
              <!-- Empty state row -->
              <tr *ngIf="filteredRoadMapDetails.length === 0" class="empty-row">
                <td colspan="3" class="empty-message text-center">
                  <i class="fa fa-inbox"></i>
                  No road map details found
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="onCloseRoadMapModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Create Request Approval Route Modal -->
<app-create-request-approval-route-modal 
  [showModal]="showCreateModal"
  (closeModal)="onCloseCreateModal()"
  (routeCreated)="onRouteCreated()">
</app-create-request-approval-route-modal>
